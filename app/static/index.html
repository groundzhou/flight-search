<!DOCTYPE html>
<html lang="en" class="wide wow-animation">

<head>
    <!-- Site Title-->
    <title>航班查询</title>
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport"
        content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <!-- Stylesheets-->
    <link rel="stylesheet" type="text/css"
        href="http://fonts.googleapis.com/css?family=Montserrat:400,700%7CLato%7CRoboto">
    <link rel="stylesheet" href="css/style.css">
    <!--[if lt IE 10]>
    <div style="background: #212121; padding: 10px 0; box-shadow: 3px 3px 5px 0 rgba(0,0,0,.3); clear: both; text-align:center; position: relative; z-index:1;"><a href="http://windows.microsoft.com/en-US/internet-explorer/"><img src="images/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today."></a></div>
    <script src="js/html5shiv.min.js"></script>
        <![endif]-->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@4.8.0/dist/echarts.min.js"></script>
</head>

<body>
    <!-- Page-->
    <div class="page">
        <!-- Page Header-->
        <header class="page-head">
            <!-- RD Navbar-->
            <div class="rd-navbar-wrap">
                <nav data-layout="rd-navbar-fixed" data-sm-layout="rd-navbar-fullwidth"
                    data-md-layout="rd-navbar-fullwidth" data-md-device-layout="rd-navbar-fixed"
                    data-lg-layout="rd-navbar-static" data-lg-device-layout="rd-navbar-static"
                    data-sm-stick-up-offset="150px" data-lg-stick-up-offset="150px" class="rd-navbar">
                    <div class="rd-navbar-inner">
                        <!-- RD Navbar Panel-->
                        <div class="rd-navbar-wrapper">
                            <div class="rd-navbar-panel">
                                <!-- RD Navbar Toggle-->
                                <button data-rd-navbar-toggle=".rd-navbar-nav-wrap"
                                    class="rd-navbar-toggle"><span></span></button>
                                <!-- RD Navbar Brand-->
                                <div class="rd-navbar-brand">
                                    <a href="index.html" class="brand-name">
                                        <div class="logo"><img src="images/logo.png" alt=""></div>
                                    </a>
                                </div>
                            </div>
                            <div class="rd-navbar-nav-wrap">
                                <!-- RD Navbar Nav-->
                                <ul class="rd-navbar-nav">
                                    <li class="active"><a href="#"><span
                                                class="material-icons-airplanemode_active icon icon-white icon-lg"></span><span>航班</span><span
                                                class="triangle"></span></a></li>
                                </ul>
                            </div><a href="#" class="btn btn-orange-2 btn-lg btn-icon"><span
                                    class="icon icon-lg icon-white material-icons-location_on"></span><span>find
                                    us</span></a>
                        </div>
                    </div>
                </nav>
            </div>
        </header>
        <!-- Page Content-->
        <main class="page-content">
            <section class="section-60 section-sm-95 bg-image bg-image-4 text-center section-sm-bottom-60">
                <div class="shell text-center">
                    <h1 class="txt-white">实时搜索</h1>
                    <div class="range">
                        <div class="cell-lg-8 cell-lg-preffix-2">
                            <!-- RD Mailform-->
                            <form class="rd-mailform text-left form-search">
                                <p class="small text-xs-right">查询航班</p>
                                <div class="range offset-top-0">
                                    <div class="cell-xs-12">
                                        <div class="checkbox-group-2">
                                            <div class="checkbox-inline">
                                                <label>
                                                    <input type="radio" name="check_way" checked="checked"
                                                        value="1">&nbsp;&nbsp;单程
                                                </label>
                                            </div>
                                            <div class="checkbox-inline">
                                                <label>
                                                    <input type="radio" name="check_way" value="2">&nbsp;&nbsp;往返
                                                </label>
                                            </div>
                                            <div class="checkbox-inline">
                                                <label>
                                                    <input type="radio" name="check_way" value="3">&nbsp;&nbsp;多程
                                                </label>
                                            </div>
                                            <div class="checkbox-inline">
                                                <label>
                                                    <input type="radio" name="check_way" value="0">&nbsp;&nbsp;无
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="cell-sm-6 offset-top-38">
                                        <div class="form-group">
                                            <label for="from" id="start_place" class="form-label">出发地</label>
                                            <input id="from" type="text" name="city" data-constraints="@Required"
                                                placeholder="请输入出发地" class="form-control">
                                        </div>
                                    </div>
                                    <div class="cell-sm-6 offset-top-38">
                                        <div class="form-group">
                                            <label for="to" id="goal_place" class="form-label">目的地</label>
                                            <input id="to" type="text" name="city2" placeholder="请输入目的地"
                                                class="form-control">
                                        </div>
                                    </div>
                                    <div class="cell-sm-4 offset-top-45">
                                        <div class="form-group date">
                                            <label for="datetimepicker1" id="start_time" class="form-label">出发时间</label>
                                            <input id="datetimepicker1" type="text" data-time-picker="date"
                                                placeholder="月/日/年" class="form-control"><span
                                                class="material-icons-event icon icon-md icon-primary"></span>
                                        </div>
                                    </div>
                                    <div class="cell-sm-4 offset-top-45">
                                        <div class="form-group date">
                                            <label for="datetimepicker2" id="return_time"
                                                class="form-label">返回时间</label>
                                            <input id="datetimepicker2" type="text" data-time-picker="date"
                                                placeholder="月/日/年" class="form-control"><span
                                                class="material-icons-event icon icon-md icon-primary"></span>
                                        </div>
                                    </div>
                                    <!-- <div class="cell-sm-8 offset-top-45">
                                        <div class="checkbox-group-2">
                                            <div class="checkbox">
                                                <label>
                            <input type="checkbox" value="">搜索前后3天
                          </label>
                                </div>
                        </div>
                    </div> -->
                                    <div class="cell-xs-12 offset-top-37">
                                        <button type="button" data-text="搜索" onclick="search()"
                                            class="btn btn-orange btn-fullwidth btn-winona btn-sm"><span>搜索</span></button>
                                    </div>
                                    <!-- <div class="cell-xs-12 offset-top-30 text-center"><a href="#" class="btn-link">高级搜索</a></div> -->
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Section Flight by region-->
            <section class="section-71 section-bottom-80 bg-gray-light">
                <div class="shell" id="search_result">
                    <h2 class="text-center">实时搜索结果</h2><br>
                    <div class="caption" style="text-align: center;">
                        <div style="width: 1000px; display: flex; text-align: center; margin-bottom: 20px;">
                            <div style="width: 200px; margin-left: 40px; margin-right: 40px;">
                                航空公司
                                <select id="airlines" name="airlines">
                                    <option value="">全部</option>
                                </select>
                            </div>
                            <div style="width: 200px; margin-left: 40px; margin-right: 40px;">
                                是否中转
                                <select id="transitFlight" name="transitFlight">
                                    <option value="2">全部</option>
                                    <option value="0">无中转</option>
                                    <option value="1">可中转</option>
                                </select>
                            </div>
                            <div style="width: 200px; margin-left: 40px; margin-right: 40px;">
                                最大价格
                                <select id="price" name="price">
                                    <option value="">无限</option>
                                    <option value="200">低于200</option>
                                    <option value="400">低于400</option>
                                    <option value="800">低于800</option>
                                    <option value="1000">低于1000</option>
                                    <option value="2000">低于2000</option>
                                </select>
                            </div>
                            <div style="width: 200px; margin-left: 40px; margin-right: 40px;">
                                排序
                                <select id="sort" name="sort">
                                    <option value="price">价格</option>
                                    <option value="time">时长</option>
                                    <option value="dtime">出发时间</option>
                                    <option value="atime">到达时间</option>
                                </select>
                            </div>
                        </div>
                        <table id="result_table" border="1" cellspacing="0" style="width: 95%;margin:auto">
                            <tr bgcolor="#FFFF00">
                                <td>航班号<br>舱位</td>
                                <td>出发地--转--目的地<br>机场--转--机场</td>
                                <td>起飞时间--落地时间<br>总时长</td>
                                <td>价格</td>
                                <td>折扣率</td>
                                <td>准点率</td>
                                <td>航空公司</td>
                                <td>机型<br>类型</td>
                            </tr>
                        </table>
                        <table id="result_table_2" border="1" cellspacing="0" style="width: 95%;margin:auto">
                        </table>
                    </div>
                </div>
            </section>
            <section class="section-71 section-bottom-80 bg-gray-light">
                <h2 class="text-center" id="daplace">何时飞</h2><br>
                <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
                <div id="container" style="height:400px;">
                    <div style="height:100%; background-image: url(images/index3.jpg);"></div>
                </div>
            </section>
            <section class="section-71 section-bottom-80 bg-gray-light">
                <h2 class="text-center" id="des">飞去哪</h2><br>
                <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
                <div id="container2" style="height:600px;">
                    <div style="height:100%; background-image: url(images/index3.jpg);"></div>
                </div>
            </section>
        </main>
    </div>
    <!-- Global Mailform Output-->
    <div id="form-output-global" class="snackbars"></div>
    <!-- PhotoSwipe Gallery-->
    <div tabindex="-1" role="dialog" aria-hidden="true" class="pswp">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button title="Close (Esc)" class="pswp__button pswp__button--close"></button>
                    <button title="Share" class="pswp__button pswp__button--share"></button>
                    <button title="Toggle fullscreen" class="pswp__button pswp__button--fs"></button>
                    <button title="Zoom in/out" class="pswp__button pswp__button--zoom"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                            <div class="pswp__preloader__cut">
                                <div class="pswp__preloader__donut"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div>
                </div>
                <button title="Previous (arrow left)" class="pswp__button pswp__button--arrow--left"></button>
                <button title="Next (arrow right)" class="pswp__button pswp__button--arrow--right"></button>
                <div class="pswp__caption">
                    <div class="pswp__caption__cent"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Java script-->
    <script src="js/core.min.js"></script>
    <script src="js/script.js"></script>
    <script src="js/china.js"></script>
    <!-- <script src="js/jquery.min.js"></script> -->
    <script type="text/javascript">
        var way;
        var start_place_name;
        var start_place;
        var goal_place_name;
        var goal_place;
        var start_time;
        var return_time;
        var airline;
        var transi;
        var sortElem;
        var price;

        function search() {
            way = $('input:radio:checked').val();
            start_place_name = document.getElementById("from").value;
            start_place = city[start_place_name];
            if (start_place == null) {
                alert("请完善搜索信息再搜索");
                return;
            }
            goal_place_name = document.getElementById("to").value;
            goal_place = city[goal_place_name];
            start_time = document.getElementById("datetimepicker1").value;
            if (start_time != null) {
                start_time = start_time.substr(6, 4) + "-" + start_time.substr(0, 2) + "-" + start_time.substr(3, 2);
            }
            return_time = document.getElementById("datetimepicker2").value;
            if (return_time != null) {
                return_time = return_time.substr(6, 4) + "-" + return_time.substr(0, 2) + "-" + return_time.substr(3, 2);
            }
            // alert(way + start_place + goal_place + start_time + return_time);

            // 单程
            if (way == 1) {
                if (start_place != null && goal_place != null && start_time != "--") {
                    $.ajax({
                        url: '/api/flights',
                        type: 'GET', //数据提交方式
                        dataType: 'json', //返回的数据类型格式
                        async: true, //异步请求
                        crossDomain: true, //跨域访问
                        xhrFields: { //标准跨域请求不发送cookie
                            withCredentials: true
                        },
                        data: {
                            d: start_place,
                            a: goal_place,
                            date: start_time
                        },
                        success: function (data) {
                            // alert(data);
                            getAirlines(data);
                            getMessage(data);
                        },
                        error: function (errorMsg) {
                            //请求失败时执行该函数
                            // alert("fail");
                        }
                    });
                } else {
                    // alert("请完善搜索信息再搜索");
                }
            }
            if (way == 2) {
                if (start_place != null && goal_place != null && start_time != "--" && return_time != "--") {
                    $.ajax({
                        url: '/api/flights',
                        type: 'GET', //数据提交方式
                        dataType: 'json', //返回的数据类型格式
                        async: true, //异步请求
                        crossDomain: true, //跨域访问
                        xhrFields: { //标准跨域请求不发送cookie
                            withCredentials: true
                        },
                        data: {
                            d: start_place,
                            a: goal_place,
                            date: start_time
                        },
                        success: function (data) {
                            // alert(data);
                            getAirlines(data);
                            getMessage(data);
                        },
                        error: function (errorMsg) {
                            //请求失败时执行该函数
                            // alert("fail");
                        }
                    });
                    $.ajax({
                        url: '/api/flights',
                        type: 'GET', //数据提交方式
                        dataType: 'json', //返回的数据类型格式
                        async: true, //异步请求
                        crossDomain: true, //跨域访问
                        xhrFields: { //标准跨域请求不发送cookie
                            withCredentials: true
                        },
                        data: {
                            d: goal_place,
                            a: start_place,
                            date: return_time
                        },
                        success: function (data) {
                            // alert(data);
                            getMessage_r(data);
                        },
                        error: function (errorMsg) {
                            //请求失败时执行该函数
                            // alert("fail");
                        }
                    });
                } else {
                    // alert("请完善搜索信息再搜索");
                }
            }
            if (start_place != null && goal_place != null && start_time == "--" && return_time == "--") {
                $.ajax({
                    url: '/api/prices',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: start_place,
                        a: goal_place
                    },
                    success: function (data) {
                        // alert(data);
                        getMessage_da(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            }
            if (start_place != null && start_time != "--" && goal_place == null && return_time == "--") {
                $.ajax({
                    url: '/api/destinations',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: start_place,
                        date: start_time
                    },
                    success: function (data) {
                        // alert(data);
                        getMessage_des(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            }
        }

        $("#airlines").change(function () {
            airline = $("#airlines").val();
            // alert(airline + price);
            getMessage_air();
        });

        $("#transitFlight").change(function () {
            transi = $("#transitFlight").val();
            if (transi == 0) {
                getMessage_notra();
            }
            if (transi == 1) {
                getMessage_trasi();
            }
            if (transi == 2) {
                getMessage_notrasi();
            }
        });

        $("#sort").change(function () {
            sortElem = $("#sort").val();
            getMessage_sort();
        });

        $("#price").change(function () {
            price = $("#price").val();
            getMessage_price();
        });

        function getAirlines(data) {
            var airlines = document.getElementById("airlines");
            airlines.innerHTML = "";

            var option = document.createElement("option");
            option.innerHTML = "<option value=''>全部</option>";
            airlines.appendChild(option);

            data = data["airlines"];
            for (var i = 0; i < data.length; i++) {
                var option = document.createElement("option");

                option.innerHTML = "<option value='" + data[i] + "'>" + data[i] + "</option>";

                airlines.appendChild(option);
            }
        }

        function getMessage(data) {
            var table = document.getElementById("result_table");
            table.innerHTML = ""; //删除table内容
            var table2 = document.getElementById("result_table_2");
            table2.innerHTML = ""; //删除table内容

            // 表头
            table.innerHTML =
                "<tr bgcolor='#FFFF00'>" +
                "<td>单程<br>航班号<br>舱位</td>" +
                "<td>出发地--转--目的地<br>机场--转--机场</td>" +
                "<td>起飞时间--落地时间<br>总时长</td>" +
                "<td>价格</td>" +
                "<td>折扣率</td>" +
                "<td>准点率</td>" +
                "<td>航空公司</td>" +
                "<td>机型<br>类型</td>" +
                "</tr>";

            ndata = data["nonstopFlight"];
            for (var i = 0; i < ndata.length; i++) {
                var tr = document.createElement("tr");

                tr.innerHTML =
                    "<tr><td>" + ndata[i].flight_num + "<br>" + ndata[i].class + "</td>" +
                    "<td>" + ndata[i].dcity + "→" + ndata[i].stop + "→" + ndata[i].acity + "<br>" +
                    ndata[i].dairport + ndata[i].dterminal + "→" + ndata[i].stop + "→" + ndata[i].aairport + ndata[i].aterminal + "</td>" +
                    "<td>" + ndata[i].dtime + "→" + ndata[i].atime + "<br>" + ndata[i].time[0] + "小时" + ndata[i].time[1] + "分钟" + "</td>" +
                    "<td><font color='red'>￥" + ndata[i].price + "</font></td>" +
                    "<td>" + ndata[i].discount + "</td>" +
                    "<td>" + ndata[i].punctuality + "%</td>" +
                    "<td>" + ndata[i].airline + "</td>" +
                    "<td>" + ndata[i].plane + "<br>" + ndata[i].plane_kind + "</td></tr>";

                table.appendChild(tr);
            }

            tdata = data["transitFlight"];
            for (var i = 0; i < tdata.length; i++) {
                var tr = document.createElement("tr");
                // alert(tdata[i]['f2.flight_num']);

                tr.innerHTML =
                    "<tr><td>" + tdata[i].flight_num + "<br>" + tdata[i].class + "<br>" + tdata[i]['f2.flight_num'] + "<br>" + tdata[i]['f2.class'] + "</td>" +
                    "<td>" + tdata[i].dcity + "→" + tdata[i].stop + "→" + tdata[i].acity + "<br>" +
                    tdata[i].dairport + tdata[i].dterminal + "→" + tdata[i].stop + "→" + tdata[i].aairport + tdata[i].aterminal + "<br>" + tdata[i]['f2.dcity'] + "→" + tdata[i]['f2.stop'] + "→" + tdata[i]['f2.acity'] + "<br>" +
                    tdata[i]['f2.dairport'] + tdata[i]['f2.dterminal'] + "→" + tdata[i]['f2.stop'] + "→" + tdata[i]['f2.aairport'] + tdata[i]['f2.aterminal'] + "</td>" +
                    "<td>" + tdata[i].dtime + "→" + tdata[i].atime + "<br>停留" + tdata[i].stoptime[0] + "小时" + tdata[i].stoptime[1] + "分钟" + "<br>" + tdata[i]['f2.dtime'] + "→" + tdata[i]['f2.atime'] + "<br>总用时" + tdata[i].time[0] + "小时" + tdata[i].time[1] + "分钟" + "</td>" +
                    "<td><font color='red'>￥" + tdata[i].price + "<br>￥" + tdata[i]['f2.price'] + "<br>合计￥" + (tdata[i].price + tdata[i]['f2.price']) + "</font></td>" +
                    "<td>" + tdata[i].discount + "<br>" + tdata[i]['f2.discount'] + "</td>" +
                    "<td>" + tdata[i].punctuality + "%<br>" + tdata[i]['f2.punctuality'] + "%</td>" +
                    "<td>" + tdata[i].airline + "<br>" + tdata[i]['f2.airline'] + "</td>" +
                    "<td>" + tdata[i].plane + "<br>" + tdata[i].plane_kind + "<br>" + tdata[i]['f2.plane'] + "<br>" + tdata[i]['f2.plane_kind'] + "</td></tr>";

                table.appendChild(tr);
            }

            window.location.hash = "search_result"; //页面滚动到搜索结果部分
        }

        function getMessage_r(data) {
            var table = document.getElementById("result_table_2");
            table.innerHTML = "";
            // 表头
            table.innerHTML =
                "<tr bgcolor='#FFFF00'>" +
                "<td>返程<br>航班号<br>舱位</td>" +
                "<td>出发地--转--目的地<br>机场--转--机场</td>" +
                "<td>起飞时间--落地时间<br>总时长</td>" +
                "<td>价格</td>" +
                "<td>折扣率</td>" +
                "<td>准点率</td>" +
                "<td>航空公司</td>" +
                "<td>机型<br>类型</td>" +
                "</tr>";

            ndata = data["nonstopFlight"];
            for (var i = 0; i < ndata.length; i++) {
                var tr = document.createElement("tr");

                tr.innerHTML =
                    "<tr><td>" + ndata[i].flight_num + "<br>" + ndata[i].class + "</td>" +
                    "<td>" + ndata[i].dcity + "→" + ndata[i].stop + "→" + ndata[i].acity + "<br>" +
                    ndata[i].dairport + ndata[i].dterminal + "→" + ndata[i].stop + "→" + ndata[i].aairport + ndata[i].aterminal + "</td>" +
                    "<td>" + ndata[i].dtime + "→" + ndata[i].atime + "<br>" + ndata[i].time[0] + "小时" + ndata[i].time[1] + "分钟" + "</td>" +
                    "<td><font color='red'>￥" + ndata[i].price + "</font></td>" +
                    "<td>" + ndata[i].discount + "</td>" +
                    "<td>" + ndata[i].punctuality + "%</td>" +
                    "<td>" + ndata[i].airline + "</td>" +
                    "<td>" + ndata[i].plane + "<br>" + ndata[i].plane_kind + "</td></tr>";

                table.appendChild(tr);
            }

            tdata = data["transitFlight"];
            for (var i = 0; i < tdata.length; i++) {
                var tr = document.createElement("tr");

                tr.innerHTML =
                    "<tr><td>" + tdata[i].flight_num + "<br>" + tdata[i].class + "<br>" + tdata[i]['f2.flight_num'] + "<br>" + tdata[i]['f2.class'] + "</td>" +
                    "<td>" + tdata[i].dcity + "→" + tdata[i].stop + "→" + tdata[i].acity + "<br>" +
                    tdata[i].dairport + tdata[i].dterminal + "→" + tdata[i].stop + "→" + tdata[i].aairport + tdata[i].aterminal + "<br>" + tdata[i]['f2.dcity'] + "→" + tdata[i]['f2.stop'] + "→" + tdata[i]['f2.acity'] + "<br>" +
                    tdata[i]['f2.dairport'] + tdata[i]['f2.dterminal'] + "→" + tdata[i]['f2.stop'] + "→" + tdata[i]['f2.aairport'] + tdata[i]['f2.aterminal'] + "</td>" +
                    "<td>" + tdata[i].dtime + "→" + tdata[i].atime + "<br>停留" + tdata[i].stoptime[0] + "小时" + tdata[i].stoptime[1] + "分钟" + "<br>" + tdata[i]['f2.dtime'] + "→" + tdata[i]['f2.atime'] + "<br>总用时" + tdata[i].time[0] + "小时" + tdata[i].time[1] + "分钟" + "</td>" +
                    "<td><font color='red'>￥" + tdata[i].price + "<br>￥" + tdata[i]['f2.price'] + "<br>合计￥" + (tdata[i].price + tdata[i]['f2.price']) + "</font></td>" +
                    "<td>" + tdata[i].discount + "<br>" + tdata[i]['f2.discount'] + "</td>" +
                    "<td>" + tdata[i].punctuality + "%<br>" + tdata[i]['f2.punctuality'] + "%</td>" +
                    "<td>" + tdata[i].airline + "<br>" + tdata[i]['f2.airline'] + "</td>" +
                    "<td>" + tdata[i].plane + "<br>" + tdata[i].plane_kind + "<br>" + tdata[i]['f2.plane'] + "<br>" + tdata[i]['f2.plane_kind'] + "</td></tr>";

                table.appendChild(tr);
            }

            window.location.hash = "search_result"; //页面滚动到搜索结果部分
        }

        function getMessage_air() {
            if (airline === "全部") {
                airline = null;
            }

            $.ajax({
                url: '/api/flights',
                type: 'GET', //数据提交方式
                dataType: 'json', //返回的数据类型格式
                async: true, //异步请求
                crossDomain: true, //跨域访问
                xhrFields: { //标准跨域请求不发送cookie
                    withCredentials: true
                },
                data: {
                    d: start_place,
                    a: goal_place,
                    date: start_time,
                    airline: airline,
                    max: price,
                    order: sortElem
                },
                success: function (data) {
                    getMessage(data);
                },
                error: function (errorMsg) {
                    //请求失败时执行该函数
                    // alert("fail");
                }
            });
            if (way == 2) {
                $.ajax({
                    url: '/api/flights',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: goal_place,
                        a: start_place,
                        date: return_time,
                        airline: airline,
                        max: price,
                        order: sortElem
                    },
                    success: function (data) {
                        getMessage_r(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            }
        }

        function getMessage_notra() {
            $.ajax({
                url: '/api/flights',
                type: 'GET', //数据提交方式
                dataType: 'json', //返回的数据类型格式
                async: true, //异步请求
                crossDomain: true, //跨域访问
                xhrFields: { //标准跨域请求不发送cookie
                    withCredentials: true
                },
                data: {
                    d: start_place,
                    a: goal_place,
                    date: start_time,
                    airline: airline,
                    max: price,
                    order: sortElem
                },
                success: function (data) {
                    data["transitFlight"] = [];
                    getMessage(data);
                },
                error: function (errorMsg) {
                    //请求失败时执行该函数
                    // alert("fail");
                }
            });
            if (way == 2) {
                $.ajax({
                    url: '/api/flights',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: goal_place,
                        a: start_place,
                        date: return_time,
                        airline: airline,
                        max: price,
                        order: sortElem
                    },
                    success: function (data) {
                        data["transitFlight"] = [];
                        getMessage_r(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            }
        }

        function getMessage_trasi() {
            $.ajax({
                url: '/api/flights',
                type: 'GET', //数据提交方式
                dataType: 'json', //返回的数据类型格式
                async: true, //异步请求
                crossDomain: true, //跨域访问
                xhrFields: { //标准跨域请求不发送cookie
                    withCredentials: true
                },
                data: {
                    d: start_place,
                    a: goal_place,
                    date: start_time,
                    airline: airline,
                    max: price,
                    order: sortElem
                },
                success: function (data) {
                    data["nonstopFlight"] = [];
                    getMessage(data);
                },
                error: function (errorMsg) {
                    //请求失败时执行该函数
                    // alert("fail");
                }
            });
            if (way == 2) {
                $.ajax({
                    url: '/api/flights',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: goal_place,
                        a: start_place,
                        date: return_time,
                        airline: airline,
                        max: price,
                        order: sortElem
                    },
                    success: function (data) {
                        data["nonstopFlight"] = [];
                        getMessage_r(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            }
        }

        function getMessage_notrasi() {
            $.ajax({
                url: '/api/flights',
                type: 'GET', //数据提交方式
                dataType: 'json', //返回的数据类型格式
                async: true, //异步请求
                crossDomain: true, //跨域访问
                xhrFields: { //标准跨域请求不发送cookie
                    withCredentials: true
                },
                data: {
                    d: start_place,
                    a: goal_place,
                    date: start_time,
                    airline: airline,
                    max: price,
                    order: sortElem
                },
                success: function (data) {
                    getMessage(data);
                },
                error: function (errorMsg) {
                    //请求失败时执行该函数
                    // alert("fail");
                }
            });
            if (way == 2) {
                $.ajax({
                    url: '/api/flights',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: goal_place,
                        a: start_place,
                        date: return_time,
                        airline: airline,
                        max: price,
                        order: sortElem
                    },
                    success: function (data) {
                        getMessage_r(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            }
        }

        function getMessage_price() {
            $.ajax({
                url: '/api/flights',
                type: 'GET', //数据提交方式
                dataType: 'json', //返回的数据类型格式
                async: true, //异步请求
                crossDomain: true, //跨域访问
                xhrFields: { //标准跨域请求不发送cookie
                    withCredentials: true
                },
                data: {
                    d: start_place,
                    a: goal_place,
                    date: start_time,
                    airline: airline,
                    max: price,
                    order: sortElem
                },
                success: function (data) {
                    getMessage(data);
                },
                error: function (errorMsg) {
                    //请求失败时执行该函数
                    // alert("fail");
                }
            });
            if (way == 2) {
                $.ajax({
                    url: '/api/flights',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: goal_place,
                        a: start_place,
                        date: return_time,
                        airline: airline,
                        max: price,
                        order: sortElem
                    },
                    success: function (data) {
                        getMessage_r(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            }
        }

        function getMessage_sort() {
            $.ajax({
                url: '/api/flights',
                type: 'GET', //数据提交方式
                dataType: 'json', //返回的数据类型格式
                async: true, //异步请求
                crossDomain: true, //跨域访问
                xhrFields: { //标准跨域请求不发送cookie
                    withCredentials: true
                },
                data: {
                    d: start_place,
                    a: goal_place,
                    date: start_time,
                    airline: airline,
                    max: price,
                    order: sortElem
                },
                success: function (data) {
                    getMessage(data);
                },
                error: function (errorMsg) {
                    //请求失败时执行该函数
                    // alert("fail");
                }
            });
            if (way == 2) {
                $.ajax({
                    url: '/api/flights',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: goal_place,
                        a: start_place,
                        date: return_time,
                        airline: airline,
                        max: price,
                        order: sortElem
                    },
                    success: function (data) {
                        getMessage_r(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            }
        }

        function getMessage_da(data) {
            var title = document.getElementById("daplace");
            title.innerHTML = start_place_name + "--->" + goal_place_name;

            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById("container"));

            // 指定图表的配置项和数据
            option = null;
            option = {
                title: {
                    text: "每天价格趋势"
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: '#999'
                        }
                    }
                },
                toolbox: {
                    feature: {
                        dataView: {
                            show: true,
                            readOnly: false
                        },
                        magicType: {
                            show: true,
                            type: ['line', 'bar']
                        },
                        restore: {
                            show: true
                        },
                        saveAsImage: {
                            show: true
                        }
                    }
                },
                legend: {
                    data: ['价格']
                },
                xAxis: [{
                    name: "日期",
                    type: 'category',
                    data: [],
                    axisPointer: {
                        type: 'shadow'
                    }
                }],
                yAxis: [{
                    type: 'value',
                    name: '价格',
                }],
                series: [{
                    name: '价格',
                    type: 'line',
                    data: [],
                    clickable: true,
                    markPoint: {
                        data: [
                            { name: "最大值", type: "max" },
                            { name: "最小值", type: "min" }

                        ],
                        label: {
                            formatter: '{c}元'//单位
                        }
                    }
                }]
            };

            // 使用指定的配置项和数据显示图表
            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }

            //加载动画
            myChart.showLoading();

            var x_value = []; //用来盛放X轴坐标值
            var y_value = []; //用来盛放Y轴坐标值

            // 异步加载数据，使用后端指定的配置项和数据显示图表

            for (var i = 0; i < data.length; i++) {
                x_value.push(data[i].ddate);
                y_value.push(data[i].min_price);
            }

            //隐藏加载
            myChart.hideLoading();

            // 填入数据
            myChart.setOption({
                xAxis: {
                    data: x_value
                },
                series: [{
                    data: y_value
                }]
            });

            myChart.on('click', function (param) {
                // console.log(param.name);
                start_time = param.name;
                // 这里根据param填写你的跳转逻辑
                $.ajax({
                    url: '/api/flights',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: start_place,
                        a: goal_place,
                        date: start_time,
                    },
                    success: function (data) {
                        getAirlines(data);
                        getMessage(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            });


            window.location.hash = "container"; //页面滚动到搜索结果部分
        }



        function getMessage_des(data) {
            var title = document.getElementById("des");
            title.innerHTML = "散点价格图";

            // 基于准备好的dom，初始化echarts实例
            var myChart = echarts.init(document.getElementById("container2"));

            // 指定图表的配置项和数据
            option = null;
            option = {
                geo: {
                    map: 'china',
                    roam: true,
                    itemStyle: { // 定义样式
                        normal: { // 普通状态下的样式
                            areaColor: '#FFF5EE',
                            borderColor: '#111'
                        },
                        emphasis: { // 高亮状态下的样式
                            areaColor: '#FFFF00'
                        }
                    }
                },
                backgroundColor: '#FFFFFF',
                title: {
                    subtext: '',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: function (params) {
                        var html = params.name + '<br/>';
                        html += params.seriesName + ":";
                        html += params.value[2]
                        return html;
                    }
                },
                //左侧小导航图标
                visualMap: {
                    show: true,
                    x: 'left',
                    y: 'center',
                    splitList: [
                        {
                            start: 1600
                        }, {
                            start: 800,
                            end: 1600
                        },
                        {
                            start: 400,
                            end: 800
                        }, {
                            start: 200,
                            end: 400
                        },
                        {
                            start: 100,
                            end: 200
                        }, {
                            start: 0,
                            end: 100
                        },
                    ],
                    color: ['#FF0000', '#FF34B3', '#FF7256', '#FF8C69', '#FFAEB9', '#FFD39B']
                },
                toolbox: {
                    show: true,
                    orient: 'vertical',
                    x: '1200',
                    y: 'center',
                    itemGap: 20,
                    feature: {
                        mark: {
                            show: true
                        },
                        dataView: {
                            show: true,
                            readOnly: false
                        },
                        restore: {
                            show: true
                        },
                        saveAsImage: {
                            show: true
                        }
                    }
                },
                //配置属性
                series: [{
                    name: '价格',
                    type: 'scatter',
                    coordinateSystem: 'geo', // series坐标系类型                     
                    itemStyle: {
                        normal: {
                            label: {
                                show: false,
                                formatter: '{b}',
                                position: 'right',
                                textStyle: {
                                    color: "#3D3D3D"
                                }
                            }
                        },
                        emphasis: {
                            label: {
                                show: true
                            }
                        }
                    },
                    data: [] //数据
                }]
            }

            // 使用指定的配置项和数据显示图表
            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }

            //加载动画
            myChart.showLoading();

            var dmtData = [];

            // 异步加载数据，使用后端指定的配置项和数据显示图表
            for (var i = 0; i < data.length; i++) {
                latitude = data[i].latitude;
                longitude = data[i].longitude;
                city = data[i].acity;
                num = data[i].min_price;
                var value = [];
                value.push(longitude, latitude, num);
                dmtData.push({
                    name: city,
                    value: value
                });
            }
            // console.log(dmtData);

            //隐藏加载
            myChart.hideLoading();

            // 填入数据
            myChart.setOption({
                series: [{
                    data: dmtData
                }]
            });

            myChart.on('click', function (param) {
                // console.log(param.name);
                goal_place = city[param.name];
                // 这里根据param填写你的跳转逻辑
                $.ajax({
                    url: '/api/flights',
                    type: 'GET', //数据提交方式
                    dataType: 'json', //返回的数据类型格式
                    async: true, //异步请求
                    crossDomain: true, //跨域访问
                    xhrFields: { //标准跨域请求不发送cookie
                        withCredentials: true
                    },
                    data: {
                        d: start_place,
                        a: goal_place,
                        date: start_time,
                    },
                    success: function (data) {
                        getAirlines(data);
                        getMessage(data);
                    },
                    error: function (errorMsg) {
                        //请求失败时执行该函数
                        // alert("fail");
                    }
                });
            });

            window.location.hash = "container2"; //页面滚动到搜索结果部分
        }


        city = {
            '阿尔山': 'YIE',
            '阿克苏': 'AKU',
            '阿拉善右旗': 'RHT',
            '阿拉善左旗': 'AXF',
            '阿勒泰': 'AAT',
            '阿里': 'NGQ',
            '澳门': 'MFM',
            '安庆': 'AQG',
            '安顺': 'AVA',
            '鞍山': 'AOG',
            '巴彦淖尔': 'RLK',
            '百色': 'AEB',
            '包头': 'BAV',
            '保山': 'BSD',
            '北海': 'BHY',
            '北京': 'BJS',
            '白城': 'DBC',
            '白山': 'NBS',
            '毕节': 'BFJ',
            '博乐': 'BPL',
            '重庆': 'CKG',
            '昌都': 'BPX',
            '常德': 'CGD',
            '常州': 'CZX',
            '朝阳': 'CHG',
            '成都': 'CTU',
            '池州': 'JUH',
            '赤峰': 'CIF',
            '揭阳': 'SWA',
            '长春': 'CGQ',
            '长沙': 'CSX',
            '长治': 'CIH',
            '承德': 'CDE',
            '沧源': 'CWJ',
            '达县': 'DAX',
            '大理': 'DLU',
            '大连': 'DLC',
            '大庆': 'DQA',
            '大同': 'DAT',
            '丹东': 'DDG',
            '稻城': 'DCY',
            '东营': 'DOY',
            '敦煌': 'DNH',
            '芒市': 'LUM',
            '额济纳旗': 'EJN',
            '鄂尔多斯': 'DSN',
            '恩施': 'ENH',
            '二连浩特': 'ERL',
            '佛山': 'FUO',
            '福州': 'FOC',
            '抚远': 'FYJ',
            '阜阳': 'FUG',
            '赣州': 'KOW',
            '格尔木': 'GOQ',
            '固原': 'GYU',
            '广元': 'GYS',
            '广州': 'CAN',
            '贵阳': 'KWE',
            '桂林': 'KWL',
            '哈尔滨': 'HRB',
            '哈密': 'HMI',
            '海口': 'HAK',
            '海拉尔': 'HLD',
            '邯郸': 'HDG',
            '汉中': 'HZG',
            '杭州': 'HGH',
            '合肥': 'HFE',
            '和田': 'HTN',
            '黑河': 'HEK',
            '呼和浩特': 'HET',
            '淮安': 'HIA',
            '怀化': 'HJJ',
            '黄山': 'TXN',
            '惠州': 'HUZ',
            '鸡西': 'JXA',
            '济南': 'TNA',
            '济宁': 'JNG',
            '加格达奇': 'JGD',
            '佳木斯': 'JMU',
            '嘉峪关': 'JGN',
            '金昌': 'JIC',
            '金门': 'KNH',
            '锦州': 'JNZ',
            '嘉义': 'CYI',
            '西双版纳': 'JHG',
            '建三江': 'JSJ',
            '晋江': 'JJN',
            '井冈山': 'JGS',
            '景德镇': 'JDZ',
            '九江': 'JIU',
            '九寨沟': 'JZH',
            '喀什': 'KHG',
            '凯里': 'KJH',
            '康定': 'KGT',
            '克拉玛依': 'KRY',
            '库车': 'KCA',
            '库尔勒': 'KRL',
            '昆明': 'KMG',
            '拉萨': 'LXA',
            '兰州': 'LHW',
            '黎平': 'HZH',
            '丽江': 'LJG',
            '荔波': 'LLB',
            '连云港': 'LYG',
            '六盘水': 'LPF',
            '临汾': 'LFQ',
            '林芝': 'LZY',
            '临沧': 'LNJ',
            '临沂': 'LYI',
            '柳州': 'LZH',
            '泸州': 'LZO',
            '洛阳': 'LYA',
            '吕梁': 'LLV',
            '澜沧': 'JMJ',
            '龙岩': 'LCX',
            '满洲里': 'NZH',
            '梅州': 'MXZ',
            '绵阳': 'MIG',
            '漠河': 'OHE',
            '牡丹江': 'MDG',
            '马祖': 'MFK',
            '南昌': 'KHN',
            '南充': 'NAO',
            '南京': 'NKG',
            '南宁': 'NNG',
            '南通': 'NTG',
            '南阳': 'NNY',
            '宁波': 'NGB',
            '宁蒗': 'NLH',
            '攀枝花': 'PZI',
            '普洱': 'SYM',
            '齐齐哈尔': 'NDG',
            '黔江': 'JIQ',
            '且末': 'IQM',
            '秦皇岛': 'BPE',
            '青岛': 'TAO',
            '庆阳': 'IQN',
            '衢州': 'JUZ',
            '日喀则': 'RKZ',
            '日照': 'RIZ',
            '三亚': 'SYX',
            '厦门': 'XMN',
            '上海': 'SHA',
            '深圳': 'SZX',
            '神农架': 'HPG',
            '沈阳': 'SHE',
            '石家庄': 'SJW',
            '塔城': 'TCG',
            '台州': 'HYN',
            '太原': 'TYN',
            '扬州': 'YTY',
            '唐山': 'TVS',
            '腾冲': 'TCZ',
            '天津': 'TSN',
            '天水': 'THQ',
            '通辽': 'TGO',
            '铜仁': 'TEN',
            '吐鲁番': 'TLQ',
            '万州': 'WXN',
            '威海': 'WEH',
            '潍坊': 'WEF',
            '温州': 'WNZ',
            '文山': 'WNH',
            '乌海': 'WUA',
            '乌兰浩特': 'HLH',
            '乌鲁木齐': 'URC',
            '无锡': 'WUX',
            '梧州': 'WUZ',
            '武汉': 'WUH',
            '武夷山': 'WUS',
            '西安': 'SIA',
            '西昌': 'XIC',
            '西宁': 'XNN',
            '锡林浩特': 'XIL',
            '香格里拉(迪庆)': 'DIG',
            '襄阳': 'XFN',
            '兴义': 'ACX',
            '徐州': 'XUZ',
            '香港': 'HKG',
            '烟台': 'YNT',
            '延安': 'ENY',
            '延吉': 'YNJ',
            '盐城': 'YNZ',
            '伊春': 'LDS',
            '伊宁市': 'YIN',
            '宜宾': 'YBP',
            '宜昌': 'YIH',
            '宜春': 'YIC',
            '义乌': 'YIW',
            '银川': 'INC',
            '永州': 'LLF',
            '榆林': 'UYN',
            '玉树': 'YUS',
            '运城': 'YCU',
            '湛江': 'ZHA',
            '张家界': 'DYG',
            '张家口': 'ZQZ',
            '张掖': 'YZY',
            '昭通': 'ZAT',
            '郑州': 'CGO',
            '中卫': 'ZHY',
            '舟山': 'HSN',
            '珠海': 'ZUH',
            '遵义(茅台)': 'WMT',
            '遵义(新舟)': 'ZYI'
        };
    </script>
</body>

</html>